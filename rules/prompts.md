# Правила работы с промптами (Prompts Rules)

Данный документ определяет стандарты создания и оптимизации промптов для системы, с учетом использования модели **Gemini 3 Flash**.

## 1. Основная модель
- **Целевая модель**: `gemini-3-flash-preview` (через шлюз `ai-mediator.ru`).
- **Особенности**: Модель чувствительна к четкой структуре и явным инструкциям по форматированию (особенно LaTeX).

## 2. Принципы оптимизации (Self-Optimization)
Поскольку основным разработчиком и пользователем промптов является сама LLM (Gemini), при создании новых или редактировании существующих промптов в папке `agent_service/prompts/` необходимо придерживаться следующих правил:

1.  **Структурированность**: Используйте четкие заголовки и списки. Gemini лучше обрабатывает информацию, разбитую на логические блоки.
2.  **Явные ограничения**: Всегда указывайте, чего делать **нельзя** (например, "не используй `\(...\)` для LaTeX").
3.  **Примеры (Few-shot)**: Всегда добавляйте блок `Примеры правильного ответа`. Это критично для поддержания стиля и формата.
4.  **Контекст задачи**: Четко определяйте роль (Role) и цель (Goal) в начале промпта.
5.  **Форматирование**: Указывайте специфические требования к разметке (KaTeX, Markdown) в отдельном блоке `ВАЖНО` или `Требования к форматированию`.

## 3. Процесс обновления
При изменении логики работы агента или добавлении новых инструментов:
1.  Сначала обновите соответствующий файл в `agent_service/prompts/`.
2.  Проверьте, что новый промпт понятен вам самим (как модели Gemini).
3.  Зафиксируйте изменения в документации сервиса.

## 4. Специфика LaTeX (KaTeX)
Для корректного рендеринга в Web UI:
- Строчные формулы: `$ ... $`
- Блочные формулы: `$$ ... $$`
- **Запрещено**: `\( ... \)`, `\[ ... \]`.