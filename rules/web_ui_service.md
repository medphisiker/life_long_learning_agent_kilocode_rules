# Web UI Сервис (web_ui_service)

Пользовательский интерфейс системы, состоящий из React фронтенда и FastAPI бэкенда. Реализован в концепции «Нетраннерской Деки» (Cyberpunk HUD).

## Технологический стек (v3.0)
- **Frontend:** React 18 + Vite.
- **Styling:** Tailwind CSS v4 (конфигурация через `@theme` в CSS).
- **Animations:** Framer Motion (эффекты появления, глитчи).
- **State:** Zustand (управление сессиями, сообщениями и выбором личности).
- **Content:** React-Markdown + Remark-Math (парсинг сложного контента).
- **Math:** KaTeX (рендеринг формул с неоновой подсветкой).
- **Icons:** Lucide React + Material Symbols.

## Структура проекта

- `backend/` — Бэкенд на FastAPI.
    - `app.py` — Основной сервер, шина событий (WebSocket).
    - `Dockerfile-dev` — Образ для разработки.
- `frontend/` — Фронтенд на React + Zustand.
    - `react/` — Исходный код React приложения.
    - `Dockerfile-dev` — Сборка фронтенда через Nginx.
- `tests/` — Интеграционные тесты всей системы.

## Ключевые компоненты
- `NetrunnerDeck.tsx` — Универсальный хаб управления. Контекстно-зависим:
    - **Чат**: только `AI_SYNC`.
    - **Теория**: `AI_SYNC` + `ANSWER_QUIZ`.
    - **Код**: `TERMINAL` + `AI_SYNC`.
    - **Функциональность (v3.2)**: Поддерживает изменение высоты (resizable) и сворачивание (minimize) до 40px кнопкой управления. При сворачивании Дека смещается за нижнюю границу экрана (`translate-y`).
- `UnifiedChat.tsx` — Единый компонент рендеринга диалогов. Поддерживает режимы `quiz_only` и `chat_only` для разделения потоков сообщений в THEORY.
- `NeuralGraph.tsx` — Интерактивный фоновый граф на SVG.
- `IdentitySelection.tsx` — Терминал выбора персонажа (8 профессиональных ролей). Выбор сохраняется в `user_service`.
- `QuizHub.tsx` — Двухпанельный интерфейс для квизов и теории.
- `AlgoLab.tsx` — Симулятор алгоритмов с IDE и расчетом сложности.

## Особенности разработки (DEV)

### Пересборка фронтенда
В текущей конфигурации `web_ui_service/docker-compose-dev.yml` для сервиса `frontend` **отсутствует монтирование папки `src`** (volumes). 
Это означает, что любые изменения в React-коде (папка `frontend/react/src`) **не подхватываются автоматически**.

**Для применения изменений во фронтенде необходимо выполнить пересборку:**
```bash
# Пересобрать и перезапустить только фронтенд
(cd web_ui_service && docker compose -f docker-compose-dev.yml up -d --build frontend)
```

Либо полный перезапуск:
```bash
./stop-dev.sh
./start-dev.sh
```

### Рендеринг контента
- **Markdown**: Поддерживается полный GFM (списки, жирный текст, заголовки) с HUD-стилизацией.
- **LaTeX**: Inline (`$`) и Block (`$$`) формулы с неоновым свечением (Lime для ИИ, Cyan для пользователя).
- **Источники (RAG)**: Автоматический парсинг JSON-подобных строк в интерактивные карточки `Neural_Knowledge_Sources`.

### WebSocket взаимодействие
Фронтенд взаимодействует с бэкендом через WebSocket (`/ws/{session_id}`) для получения мгновенных обновлений:
- Системные статусы (progress events).
- Ход мыслей модели (reasoning/thought).
- Финальные ответы.

### Управление сессиями (v2.1)
- **Генерация ID**: Сессии создаются в формате `{username}_{random_hash}`.
- **Привязка**: Каждая сессия при создании регистрируется в `user_service` для привязки к владельцу.
- **Персонализация**: Выбранный `identityId` сохраняется в `AppSettings` пользователя и восстанавливается при входе.
- **Безопасность**: Пользователи видят только свои сессии. Роль `developer` дает доступ к системным и тестовым (`test_`) сессиям.
- **Logout**: Кнопка разлогина в `ActivityBar` вызывает метод `logout`, очищающий локальный токен и состояние.

### UI/UX Стандарты (v3.1)
- **IDE Layout**: Глобальный скроллинг страницы отключен (`overflow-hidden` в `main.tsx`). Каждая панель (Чат, Теория, Код) имеет независимый внутренний скроллинг.
- **Quiz UI**: Ответы пользователя в режиме квиза маркируются как `QUIZZ-ANSWER` и подсвечиваются Cyan-цветом.

### Интеграционные тесты (NetRunner Scenarios)
- Сценарии и команды запуска вынесены в [`testing.md`](testing.md).
- Логи тестов сохраняются в `web_ui_service/tests/logs/`.