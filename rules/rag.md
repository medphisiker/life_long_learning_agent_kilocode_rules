# RAG Сервис (rag)

Сервис для реализации гибридного и семантического поиска по учебнику Яндекса по ML. Использует Qdrant в качестве векторной БД и Redis для кэширования.

## Структура проекта

- `app/` — Основной код приложения.
    - `main.py` — Точка входа FastAPI, настройка роутов.
    - `rag_service.py` — Основная логика RAG (объединение поиска и генерации).
    - `retriever.py` — Логика поиска в Qdrant (семантический поиск).
    - `schemas.py` — Pydantic модели для API.
    - `config.py` — Конфигурация приложения.
    
    ## API Эндпоинты
    
    - `GET /health` — Проверка состояния сервиса. Возвращает статус подключения к Qdrant, Redis, наличие коллекции и **количество parent-документов в Redis** (`redis_parent_docs_count`).
    - `POST /search` — Поиск релевантных документов (гибридный поиск).
    - `POST /rag` — Генерация ответа на основе найденного контекста.
- `llm_service/` — Интеграция с языковыми моделями.
- `backup_downloader/` — Скрипты для скачивания бэкапов данных/индексов.
- `notebook/` — Jupyter ноутбуки для экспериментов (ETL, оценка метрик, Ragas).
- `tests/` — Наборы данных и скрипты для оценки качества RAG.
- `docs/` — Документация по миграции Qdrant и совместимости версий.

## Файлы конфигурации

- `docker-compose-dev.yml` — Окружение для разработки (локальная сборка). **Важно**: требует наличия внешних томов `rag_qdrant_storage` и `rag_redis_data`.
- `docker-compose-prod.yml` — Продакшн окружение (образы из GHCR).
- `docker-compose-bootstrap.yml` — Инициализация базы знаний (скачивание бэкапов и импорт в Qdrant/Redis).
- `settings.py` — Глобальные настройки проекта.
- `.env.example` — Шаблон переменных окружения.

## Ключевые порты
- `8000` — API сервис.
- `6333` / `6334` — Qdrant (HTTP/gRPC).
- `6379` — Redis.
- `8081` — Redis Commander (Web UI для Redis).