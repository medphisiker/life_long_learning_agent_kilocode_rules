# Сервис Пользователей (user_service)

Сервис для управления пользователями, их аутентификацией, персональными настройками LLM и историей взаимодействия с системой.

## Функциональность

- **Аутентификация**: JWT-based аутентификация (OAuth2 Password Flow).
- **Управление профилем**: Хранение данных пользователя.
- **Настройки LLM**: Персональные предпочтения провайдеров и моделей для Агента, RAG и Генератора тестов.
- **История сессий**: Хранение метаданных сессий чата (связь с `agent_service`).
- **Результаты квизов**: Хранение истории прохождения тестов (связь с `test_generator`).

## Стек технологий

- **FastAPI**: Веб-фреймворк.
- **PostgreSQL**: Реляционная база данных для персистентного хранения.
- **SQLAlchemy (Async)**: ORM для работы с БД.
- **Alembic**: Миграции базы данных.
- **Passlib**: Хеширование паролей (используется `bcrypt==4.0.1` для совместимости).
- **Python-jose**: Работа с JWT токенами.

## Структура проекта

- `app/api/` — Роуты для аутентификации, настроек и истории.
- `app/core/` — Конфигурация, безопасность и JWT логика.
- `app/db/` — Инициализация БД и асинхронные сессии.
- `app/models/` — Определение таблиц SQLAlchemy.
- `app/schemas/` — Pydantic модели для API.
- `scripts/register_user.py` — CLI инструмент для регистрации пользователей администратором.

## Взаимодействие

- **Web UI Backend**: Выступает в роли шлюза, проксирует запросы на логин и настройки в `user_service`.
- **Сетевое взаимодействие**: В Docker-сетях сервис доступен по алиасу `user_service`. В DEV-окружении проброшен порт `8010`.
- **База данных**: Использует внешний том `user_postgres_data` для сохранения данных.

## Безопасность

- Доступ к данным строго ограничен владельцем (User Isolation).
- Пароли хранятся только в виде хешей (bcrypt).